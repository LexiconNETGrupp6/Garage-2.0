@using Garage_2._0.ConstantValues
@model IEnumerable<VehicleViewModel>

@{
    ViewData["Title"] = "Garage";
}

@{
    int available = ViewBag.AvailableSpots;
}

@section CustomStyles {
    <style>
        /* Targets 'th' elements that have an 'a' child */
       th:has(a):hover {
            cursor: pointer;
            filter: brightness(1.3);
            text-decoration: underline;
        }

        th > a {
            text-decoration: inherit;
            color: inherit;
            padding: inherit;
            display: inline-block;
            padding: 1em !important;
        }

        th {
            padding: 0 !important;
        }
    </style>
}

<form asp-action="Index" method="get" class="row g-2 mb-4">
    <div class="input-group col-md-12 shadow-sm">
        <span class="input-group-text">
            üîç
        </span>
        <input type="text"
               name="search"
               value="@ViewData[FilterConsts.CURRENT_FILTER]"
               class="form-control"
               placeholder="Search by reg number, brand, model or color..." />
        <button type="submit" class="btn btn-primary">Search</button>
        <a asp-action="Index" class="btn btn-outline-secondary">Clear</a>
    </div> 
</form>

<p style="font-size:1.2em;">
    Available parking spots:
    <strong style="color:@(available > 0 ? "green" : "red")">@ViewBag.AvailableSpots</strong> / @ViewBag.TotalSpots
</p>
<h5>Parking Map</h5>
<div class="mb-3">
    <span style="
        display:inline-block;
        width:20px;
        height:20px;
        background-color:#dc3545;
        margin-right:5px;
        border-radius:4px;">
    </span>
    <strong>Occupied</strong>

    <span style="
        display:inline-block;
        width:20px;
        height:20px;
        background-color:#28a745;
        margin-left:20px;
        margin-right:5px;
        border-radius:4px;">
    </span>
    <strong>Available</strong>
</div>
<div style="display:flex; flex-wrap:wrap; gap:10px; margin-bottom:30px;">
    @foreach (var spot in ViewBag.ParkingMap)
    {
        <div style="
            width:70px;
            height:70px;
            display:flex;
            align-items:center;
            justify-content:center;
            border-radius:6px;
            font-weight:bold;
            color:white;
            background-color:@(spot.IsOccupied ? "#dc3545" : "#28a745")">
            @spot.SpotNumber
        </div>
    }
</div>
<p>
    <a asp-action="Create" class="btn btn-success">Check in vehicle</a>
</p>

<table class="table table-striped table-hover align-middle">
    <thead class="table-dark">
        <tr>
            <th>
                <a asp-action="Index" 
                    asp-route-search="@ViewData[FilterConsts.CURRENT_FILTER]"
                   asp-route-sortOrder="@(ViewData[OverviewSortingConsts.TYPE_SORT] as string)"
                   class="d-flex justify-content-between w-100 h-100">
                    <span>@Html.DisplayNameFor(model => model.VehicleType)</span><span>‚Üï</span>
                </a>
            </th>
            <th>
                <a asp-action="Index"
                   asp-route-search="@ViewData[FilterConsts.CURRENT_FILTER]"
                   asp-route-sortOrder="@(ViewData[OverviewSortingConsts.REG_SORT] as string)"
                   class="d-flex justify-content-between w-100 h-100">
                    <span>@Html.DisplayNameFor(model => model.RegNumber)</span><span>‚Üï</span>
                </a>
            </th>
            <th>
                <a asp-action="Index"
                   asp-route-search="@ViewData[FilterConsts.CURRENT_FILTER]"
                   asp-route-sortOrder="@(ViewData[OverviewSortingConsts.BRAND_SORT] as string)"
                   class="d-flex justify-content-between w-100 h-100">
                    <span>@Html.DisplayNameFor(model => model.Brand)</span><span>‚Üï</span>
                </a>
            </th>

            <th>
                <a asp-action="Index" 
                   asp-route-search="@ViewData[FilterConsts.CURRENT_FILTER]"
                   asp-route-sortOrder="@(ViewData[OverviewSortingConsts.ARRIVAL_SORT] as string)"
                   class="d-flex justify-content-between w-100 h-100">
                    <span>@Html.DisplayNameFor(model => model.ArrivalTime)</span><span>‚Üï</span>
                </a>
            </th>
            <th>
                <a asp-action="Index" 
                   asp-route-search="@ViewData[FilterConsts.CURRENT_FILTER]"
                   asp-route-sortOrder="@(ViewData[OverviewSortingConsts.DURATION_SORT] as string)"
                   class="d-flex justify-content-between w-100 h-100">
                    <span>@Html.DisplayNameFor(model => model.ParkDuration)</span><span>‚Üï</span>
                </a>
            </th>
            <th>
                <a asp-action="Index" 
                   asp-route-search="@ViewData[FilterConsts.CURRENT_FILTER]" 
                   asp-route-sortOrder="@(ViewData[OverviewSortingConsts.SPOT_SORT] as string)"
                   class="d-flex justify-content-between w-100 h-100">
                    <span>@Html.DisplayNameFor(model => model.ParkingSpot)</span><span>‚Üï</span>
                </a>
            </th>
            <th id="table-buttons" class="text-end"></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var v in Model)
        {
            <tr>
                <td>@v.VehicleType</td>
                <td>@v.RegNumber</td>
                <td>@v.Brand</td>
                <td>@v.ArrivalTime</td>
                <td>@v.ParkDuration</td>
                <td>@v.ParkingSpot</td>
                <td class="text-end">
                    <a asp-action="Details" asp-route-id="@v.Id" class="btn btn-sm btn-outline-info">Details</a>
                    <a asp-action="Edit" asp-route-id="@v.Id" class="btn btn-sm btn-outline-warning">Edit</a>
                    <a asp-action="Checkout" asp-route-id="@v.Id" class="btn btn-sm btn-outline-danger">Check out</a>
                </td>
            </tr>
        }
    </tbody>
</table>